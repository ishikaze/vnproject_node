<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VN Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #121212; color: #eee; font-family: sans-serif; margin: 0; padding: 20px; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; border-bottom: 1px solid #333; padding-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .card { background: #1e1e1e; border: 1px solid #333; border-radius: 8px; overflow: hidden; transition: transform 0.2s; }
        .card:hover { transform: translateY(-5px); border-color: #007acc; }
        .card-img { height: 140px; background: #333; display: flex; align-items: center; justify-content: center; color: #555; }
        .card-content { padding: 15px; }
        h3 { margin: 0 0 5px 0; color: #fff; }
        p { color: #aaa; font-size: 0.9em; }
        a { text-decoration: none; color: inherit; }
        .btn { background: #007acc; color: white; padding: 8px 15px; border-radius: 4px; }
        /* Stats Badges on Cards */
        .card-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #333;
        }

        .stat-badge {
            font-size: 0.75rem;
            color: #888;
            display: flex;
            align-items: center;
            gap: 4px;
            background: #111;
            padding: 2px 8px;
            border-radius: 4px;
            border: 1px solid #222;
        }

        .stat-badge i {
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <header>
        <h1><i class="fa-solid fa-book"></i> VNProject</h1>
        <div>
            <% if(user) { %>
                <a href="/collections" class="btn" style="background:#2d3436; margin-right:5px;">Collections</a>
                <a href="/dashboard" class="btn">My Dashboard</a>
                <a href="/logout" style="margin-left: 10px; color: #aaa;">Logout</a>
            <% } else { %>
                <a href="/auth/discord" class="btn"><i class="fa-brands fa-discord"></i> Login</a>
            <% } %>
        </div>
    </header>

    <h2>Latest Visual Novels</h2>
    <div class="grid">
        <% projects.forEach(p => { %>
            <a href="/series/<%= p.id %>" class="card">
                <div class="card-img">
                    <!-- Ideally user uploaded cover, for now placeholder -->
                    <i class="fa-solid fa-image fa-2x"></i>
                </div>
                <div class="card-content">
                    <h3><%= p.title %></h3>
                    <p>By <%= p.display_name %> (<%= p.username %>)</p>
                    <p style="font-style: italic; margin-top: 5px; height: 1.2em; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                        <%= p.description || 'No description.' %>
                    </p>

                    <!-- STATS BADGES -->
                    <div class="card-stats">
                        <div class="stat-badge views" title="Total Views">
                            <i class="fa-solid fa-eye"></i> <%= p.view_count %>
                        </div>
                        <div class="stat-badge likes" title="Series Likes">
                            <i class="fa-solid fa-heart"></i> <%= p.like_count %>
                        </div>
                        <div class="stat-badge rating" title="Average Rating">
                            <i class="fa-solid fa-star"></i> 
                            <%= p.avg_rating ? parseFloat(p.avg_rating).toFixed(1) : 'NR' %>
                        </div>
                        <div class="stat-badge comments" title="Total Comments">
                            <i class="fa-solid fa-comment"></i> <%= p.comment_count %>
                        </div>
                    </div>
                </div>
            </a>
        <% }) %>
    </div>
</body>
</html>